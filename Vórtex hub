-- V√≥rtex Hub completo
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- Vari√°veis globais
getgenv().ESPEnabled = false
getgenv().AimlockEnabled = false
getgenv().FOVSize = 30
getgenv().HitboxSize = 2

-- GUI
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 220, 0, 260)
Frame.Position = UDim2.new(0.05, 0, 0.2, 0)
Frame.BackgroundColor3 = Color3.fromRGB(255, 0, 0) -- vermelho neon
Frame.Active = true
Frame.Draggable = true

-- T√≠tulo
local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1,0,0,40)
Title.Text = "V√≥rtex Hub"
Title.TextColor3 = Color3.new(1,1,1)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20

-- Bot√µes
local ESPButton = Instance.new("TextButton", Frame)
ESPButton.Size = UDim2.new(1,0,0,40)
ESPButton.Position = UDim2.new(0,0,0,50)
ESPButton.Text = "Ativar ESP"
ESPButton.BackgroundColor3 = Color3.fromRGB(150,0,0)
ESPButton.TextColor3 = Color3.new(1,1,1)

local AimButton = Instance.new("TextButton", Frame)
AimButton.Size = UDim2.new(1,0,0,40)
AimButton.Position = UDim2.new(0,0,0,100)
AimButton.Text = "Ativar Aimlock"
AimButton.BackgroundColor3 = Color3.fromRGB(150,0,0)
AimButton.TextColor3 = Color3.new(1,1,1)

local FOVPlus = Instance.new("TextButton", Frame)
FOVPlus.Size = UDim2.new(0.5,0,0,40)
FOVPlus.Position = UDim2.new(0,0,0,150)
FOVPlus.Text = "+ FOV"
FOVPlus.BackgroundColor3 = Color3.fromRGB(150,0,0)
FOVPlus.TextColor3 = Color3.new(1,1,1)

local FOVMinus = Instance.new("TextButton", Frame)
FOVMinus.Size = UDim2.new(0.5,0,0,40)
FOVMinus.Position = UDim2.new(0.5,0,0,150)
FOVMinus.Text = "- FOV"
FOVMinus.BackgroundColor3 = Color3.fromRGB(150,0,0)
FOVMinus.TextColor3 = Color3.new(1,1,1)

local HitboxPlus = Instance.new("TextButton", Frame)
HitboxPlus.Size = UDim2.new(0.5,0,0,40)
HitboxPlus.Position = UDim2.new(0,0,0,200)
HitboxPlus.Text = "+ Hitbox"
HitboxPlus.BackgroundColor3 = Color3.fromRGB(150,0,0)
HitboxPlus.TextColor3 = Color3.new(1,1,1)

local HitboxMinus = Instance.new("TextButton", Frame)
HitboxMinus.Size = UDim2.new(0.5,0,0,40)
HitboxMinus.Position = UDim2.new(0.5,0,0,200)
HitboxMinus.Text = "- Hitbox"
HitboxMinus.BackgroundColor3 = Color3.fromRGB(150,0,0)
HitboxMinus.TextColor3 = Color3.new(1,1,1)

-- ESP Drawing
local DrawingAvailable, Drawing = pcall(function() return Drawing end)
local espLines = {}
local function ClearESP()
    for _, line in pairs(espLines) do
        line:Remove()
    end
    espLines = {}
end

local function CreateESP(player)
    if player == LocalPlayer then return end
    local line = Drawing.new("Line")
    line.Thickness = 2
    line.Color = Color3.fromRGB(138,43,226) -- roxo neon (wallhack)
    espLines[player] = line
    RunService.RenderStepped:Connect(function()
        if getgenv().ESPEnabled and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local vector, onScreen = Camera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
            if onScreen then
                line.From = Vector2.new(Camera.ViewportSize.X/2,0)
                line.To = Vector2.new(vector.X, vector.Y)
                line.Visible = true
            else
                line.Visible = false
            end
        else
            line.Visible = false
        end
    end)
end

Players.PlayerAdded:Connect(CreateESP)
for _, player in pairs(Players:GetPlayers()) do
    CreateESP(player)
end

-- Bot√µes
ESPButton.MouseButton1Click:Connect(function()
    getgenv().ESPEnabled = not getgenv().ESPEnabled
    ESPButton.Text = getgenv().ESPEnabled and "Desativar ESP" or "Ativar ESP"
    if not getgenv().ESPEnabled then ClearESP() end
end)

AimButton.MouseButton1Click:Connect(function()
    getgenv().AimlockEnabled = not getgenv().AimlockEnabled
    AimButton.Text = getgenv().AimlockEnabled and "Desativar Aimlock" or "Ativar Aimlock"
end)

FOVPlus.MouseButton1Click:Connect(function()
    if getgenv().FOVSize < 50 then getgenv().FOVSize += 1 end
end)

FOVMinus.MouseButton1Click:Connect(function()
    if getgenv().FOVSize > 1 then getgenv().FOVSize -= 1 end
end)

HitboxPlus.MouseButton1Click:Connect(function()
    if getgenv().HitboxSize < 10 then getgenv().HitboxSize += 1 end
end)

HitboxMinus.MouseButton1Click:Connect(function()
    if getgenv().HitboxSize > 2 then getgenv().HitboxSize -= 1 end
end)

-- Bot√£o minimizado m√≥vel
local MinimizedButton = Instance.new("TextButton")
MinimizedButton.Size = UDim2.new(0,50,0,50)
MinimizedButton.Position = UDim2.new(0,50,0,100)
MinimizedButton.BackgroundColor3 = Color3.fromRGB(255,0,0)
MinimizedButton.Text = "üî´"
MinimizedButton.TextScaled = true
MinimizedButton.Visible = false
MinimizedButton.Active = true
MinimizedButton.Draggable = true
MinimizedButton.Parent = ScreenGui

-- Minimizar menu
local MinButton = Instance.new("TextButton", Frame)
MinButton.Size = UDim2.new(0.25,0,0,30)
MinButton.Position = UDim2.new(0.75,0,0,0)
MinButton.Text = "‚Äî"
MinButton.TextScaled = true
MinButton.BackgroundColor3 = Color3.fromRGB(255,0,0)
MinButton.TextColor3 = Color3.new(1,1,1)

MinButton.MouseButton1Click:Connect(function()
    Frame.Visible = false
    MinimizedButton.Visible = true
end)

MinimizedButton.MouseButton1Click:Connect(function()
    Frame.Visible = true
    MinimizedButton.Visible = false
end)                end
            end
        end
    end
    return closest
end

-- Cria√ß√£o do V√≥rtex Hub
local function CreateVortexHub()
    if LocalPlayer.PlayerGui:FindFirstChild("VortexHub") then
        LocalPlayer.PlayerGui.VortexHub:Destroy()
    end

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "VortexHub"
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(0, 250, 0, 280)
    Frame.Position = UDim2.new(0, 50, 0, 100)
    Frame.BackgroundColor3 = Color3.fromRGB(255,50,50) -- vermelho neon
    Frame.Active = true
    Frame.Draggable = true
    Frame.Parent = ScreenGui

    -- Cabe√ßalho
    local Header = Instance.new("Frame")
    Header.Size = UDim2.new(1,0,0,30)
    Header.BackgroundColor3 = Color3.fromRGB(8,58,125)
    Header.BorderSizePixel = 0
    Header.Parent = Frame

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(0.7, -8, 1, 0)
    Title.Position = UDim2.new(0,8,0,0)
    Title.BackgroundTransparency = 1
    Title.Text = "V√≥rtex Hub"
    Title.Font = Enum.Font.GothamBold
    Title.TextScaled = true
    Title.TextColor3 = Color3.fromRGB(255,255,255)
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = Header

    local MinButton = Instance.new("TextButton")
    MinButton.Size = UDim2.new(0.25, -8, 1, -6)
    MinButton.Position = UDim2.new(0.75, 0, 0, 3)
    MinButton.Text = "‚Äî"
    MinButton.Font = Enum.Font.Gotham
    MinButton.TextScaled = true
    MinButton.TextColor3 = Color3.fromRGB(255,255,255)
    MinButton.BackgroundColor3 = Color3.fromRGB(14,92,193)
    MinButton.BorderSizePixel = 0
    MinButton.Parent = Header

    -- Container
    local Content = Instance.new("Frame")
    Content.Size = UDim2.new(1, 0, 1, -30)
    Content.Position = UDim2.new(0, 0, 0, 30)
    Content.BackgroundTransparency = 1
    Content.Parent = Frame

    local function makeButton(text, y)
        local btn = Instance.new("TextButton", Content)
        btn.Size = UDim2.new(0.92, 0, 0, 30)
        btn.Position = UDim2.new(0.04, 0, 0, y)
        btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        btn.TextColor3 = Color3.fromRGB(255,255,255)
        btn.Font = Enum.Font.Gotham
        btn.TextScaled = true
        btn.Text = text
        return btn
    end

    local AimButton = makeButton("Aimlock: OFF", 10)
    local WHButton  = makeButton("Wallhack: OFF", 50)
    local ESPLineButton = makeButton("ESP Linha: OFF", 90)
    local FOVButton = makeButton("FOV: OFF", 130)

    -- FOV com + e -
    local FOVFrame = Instance.new("Frame")
    FOVFrame.Size = UDim2.new(0.92,0,0,30)
    FOVFrame.Position = UDim2.new(0.04,0,0,170)
    FOVFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)
    FOVFrame.Parent = Content

    local MinusButton = Instance.new("TextButton")
    MinusButton.Size = UDim2.new(0.2,0,1,0)
    MinusButton.Position = UDim2.new(0,0,0,0)
    MinusButton.Text = "-"
    MinusButton.TextScaled = true
    MinusButton.Font = Enum.Font.Gotham
    MinusButton.BackgroundColor3 = Color3.fromRGB(150,0,0)
    MinusButton.TextColor3 = Color3.fromRGB(255,255,255)
    MinusButton.Parent = FOVFrame

    local FOVLabel = Instance.new("TextLabel")
    FOVLabel.Size = UDim2.new(0.6,0,1,0)
    FOVLabel.Position = UDim2.new(0.2,0,0,0)
    FOVLabel.BackgroundTransparency = 1
    FOVLabel.TextColor3 = Color3.fromRGB(255,255,255)
    FOVLabel.TextScaled = true
    FOVLabel.Font = Enum.Font.Gotham
    FOVLabel.Text = tostring(FOVRadius)
    FOVLabel.Parent = FOVFrame

    local PlusButton = Instance.new("TextButton")
    PlusButton.Size = UDim2.new(0.2,0,1,0)
    PlusButton.Position = UDim2.new(0.8,0,0,0)
    PlusButton.Text = "+"
    PlusButton.TextScaled = true
    PlusButton.Font = Enum.Font.Gotham
    PlusButton.BackgroundColor3 = Color3.fromRGB(0,150,0)
    PlusButton.TextColor3 = Color3.fromRGB(255,255,255)
    PlusButton.Parent = FOVFrame

    MinusButton.MouseButton1Click:Connect(function()
        FOVRadius = math.clamp(FOVRadius - 1, 1, 50)
        FOVLabel.Text = tostring(FOVRadius)
    end)

    PlusButton.MouseButton1Click:Connect(function()
        FOVRadius = math.clamp(FOVRadius + 1, 1, 50)
        FOVLabel.Text = tostring(FOVRadius)
    end)

    -- Minimiz√°vel
    local MinimizedButton = Instance.new("TextButton")
    MinimizedButton.Size = UDim2.new(0, 50, 0, 50)
    MinimizedButton.Position = UDim2.new(0, 50, 0, 100)
    MinimizedButton.BackgroundColor3 = Color3.fromRGB(255, 102, 0)
    MinimizedButton.Text = "üçï"
    MinimizedButton.Visible = false
    MinimizedButton.TextScaled = true
    MinimizedButton.Parent = ScreenGui

    MinButton.MouseButton1Click:Connect(function()
        Content.Visible = false
        Frame.Visible = false
        MinimizedButton.Visible = true
    end)
    MinimizedButton.MouseButton1Click:Connect(function()
        Content.Visible = true
        Frame.Visible = true
        MinimizedButton.Visible = false
    end)

    -- Bot√µes
    AimButton.MouseButton1Click:Connect(function()
        AimLockEnabled = not AimLockEnabled
        AimButton.Text = "Aimlock: " .. (AimLockEnabled and "ON" or "OFF")
    end)

    WHButton.MouseButton1Click:Connect(function()
        WallhackEnabled = not WallhackEnabled
        WHButton.Text = "Wallhack: " .. (WallhackEnabled and "ON" or "OFF")
    end)

    ESPLineButton.MouseButton1Click:Connect(function()
        ESPLineEnabled = not ESPLineEnabled
        ESPLineButton.Text = "ESP Linha: " .. (ESPLineEnabled and "ON" or "OFF")
    end)

    FOVButton.MouseButton1Click:Connect(function()
        FOVEnabled = not FOVEnabled
        FOVButton.Text = "FOV: " .. (FOVEnabled and "ON" or "OFF")
    end)
end

-- Inicializa
CreateVortexHub()

-- Respawn seguro
LocalPlayer.CharacterAdded:Connect(function()
    wait(0.5)
    ClearESP()
    CreateVortexHub()
end)

-- Limpa ESP ao morrer
LocalPlayer.Character:WaitForChild("Humanoid").Died:Connect(function()
    ClearESP()
end)

-- RenderStepped
RunService.RenderStepped:Connect(function()
    local topCenter = Vector2.new(Camera.ViewportSize.X/2, 0)
    
    -- FOV Circle
    if FOVCircle then
        local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
        FOVCircle.Position = center
        FOVCircle.Visible = FOVEnabled
        FOVCircle.Radius = FOVRadius
    end

    -- Aimlock
    if AimLockEnabled then
        local target = GetClosestEnemyInFOV()
        if target then
            local camPos = Camera.CFrame.Position
            Camera.CFrame = CFrame.new(camPos, target.Position)
        end
    end

    -- Wallhack
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character then
            local hum = plr.Character:FindFirstChild("Humanoid")
            if hum and hum.Health > 0 then
                if WallhackEnabled then
                    applyHighlight(plr.Character)
                else
                    if plr.Character:FindFirstChild("VortexHighlight") then
                        plr.Character.VortexHighlight:Destroy()
                    end
                end
            end
        end
    end

    -- ESP Linha e barra de vida lateral
    if DrawingAvailable and ESPLineEnabled then
        for _, plr in pairs(Players:GetPlayers()) do
            local line = GetLine(plr)
            local healthBar = GetHealthBar(plr)
            if plr ~= LocalPlayer and plr.Team ~= LocalPlayer.Team and plr.Character then
                local hum = plr.Character:FindFirstChild("Humanoid")
                local head = plr.Character:FindFirstChild("Head")
                if hum and hum.Health > 0 and head then
                    local pos, onScreen = Camera:WorldToViewportPoint(head.Position)
                    if onScreen and pos.Z > 0 then
                        local screenX = math.clamp(pos.X, 0, Camera.ViewportSize.X)
                        local screenY = math.clamp(pos.Y, 0, Camera.ViewportSize.Y)
                        
                        -- Linha do topo
                        line.From = topCenter
                        line.To = Vector2.new(screenX, screenY)
                        line.Visible = true
                        
                        -- Barra vertical lateral
                        local barWidth = 6
                        local barHeight = 40
                        local healthPercent = math.clamp(hum.Health / hum.MaxHealth, 0, 1)
                        healthBar.Size = Vector2.new(barWidth, barHeight * healthPercent)
                        healthBar.Position = Vector2.new(screenX + 15, screenY - barHeight/2)
                        healthBar.Color = Color3.fromRGB(255 * (1 - healthPercent), 255 * healthPercent, 0)
                        healthBar.Visible = true
                    else
                        line.Visible = false
                        healthBar.Visible = false
                    end
                else
                    line.Visible = false
                    healthBar.Visible = false
                end
            else
                line.Visible = false
                healthBar.Visible = false
            end
        end
    end
end)
